<!DOCTYPE html>
<html lang="en">
    <title>test</title>
    <script type="text/javascript" src="/assets/alasql-worker.min.js"></script>
    <script>

        async function dropDB(dbname = 'web') {
          await alasql.promise(`DROP INDEXEDDB DATABASE ${dbname}`);
        }

        async function initDB(dbname = 'web') {
          const create_db_stmt = "CREATE INDEXEDDB DATABASE IF NOT EXISTS " + dbname;
          const attach_db_stmt = "ATTACH INDEXEDDB DATABASE " + dbname;
          const use_db_stmt = "USE " + dbname;
          
          const tasks = [create_db_stmt, attach_db_stmt, use_db_stmt];
          
          for (const task of tasks) await alasql.promise(task);
        }

        async function initData() {
            await alasql.promise("CREATE TABLE  IF NOT EXISTS cities (city string, population number)");
            await alasql.promise('delete from cities where 1 = 1');
            await alasql.promise("INSERT INTO cities VALUES ('Rome',2863223), ('Paris',2249975), ('Berlin',3517424), ('Madrid',3041579)");
            return await alasql.promise("SELECT * FROM cities WHERE population < 3500000 ORDER BY population DESC");
        }

        async function importFlat() {
          const r = await  fetch('data1.json');
          const data = await r.json()
          await alasql.promise("CREATE TABLE  IF NOT EXISTS employees (name, position, office, age, start_date, salary)");
          await alasql.promise('INSERT INTO employees SELECT [0] as name, [1] as position, [2] as office, [3] as age, [4] as start_date, [5] as salary FROM ?', [data]);          
          return await alasql.promise('select * from employees');
        }


        async function importJSON() {
          const r = await  fetch('data2.json');
          const data = await r.json();

          const cols = Object.keys(data.shift()).join('`,`');
          await alasql.promise(`CREATE TABLE  IF NOT EXISTS employees (\`${cols}\`)`);
          // await alasql.promise("CREATE TABLE  IF NOT EXISTS employees (Name, Position, Office, Age, `Start date`, Salary)");
          await alasql.promise('INSERT INTO employees SELECT * FROM ?', [data]);
          return await alasql.promise('select * from employees');
        }

        /*
        alasql('SELECT * FROM ?', [data]);
        alasql('SELECT * INTO employees FROM ?', [data]);
        alasql('INSERT INTO employees SELECT * FROM ?',[data]);
        */        

        // initDB("web").then(initData);
    </script>
<body>


</body>
</html>